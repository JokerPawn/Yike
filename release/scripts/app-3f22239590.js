var Yike=angular.module("Yike",["ngRoute","Controllers","Directives"]);Yike.config(["$routeProvider",function(o){o.when("/today",{templateUrl:"./views/today.html",controller:"TodayController"}).when("/older",{templateUrl:"./views/older.html",controller:"OlderController"}).when("/author",{templateUrl:"./views/author.html",controller:"AuthorController"}).when("/category",{templateUrl:"./views/category.html",controller:"CategoryController"}).when("/settings",{templateUrl:"./views/settings.html",controller:"SettingsController"}).when("/center",{templateUrl:"./views/center.html",controller:"CenterController"}).when("/list",{templateUrl:"./views/list.html",controller:"ListController"}).otherwise({redirectTo:"/today"})}]),Yike.run(["$rootScope",function(o){o.collapsed=!1,o.toggle=function(){o.collapsed=!o.collapsed;var e=document.querySelectorAll(".navs dd");if(o.collapsed)for(var t=0;t<e.length;t++)e[t].style.transform="translate(0)",e[t].style.transitionDelay="0.2s",e[t].style.transitionDuration=.1*(t+1)+"s";else for(var l=e.length-1,r=l;r>0;r--)e[r].style.transform="translate(-100%)",e[r].style.transitionDelay="",e[r].style.transitionDuration=.16*(l-r)+"s"}}]),angular.module("Directives",[]).directive("loading",function(){return{restrict:"A",replace:!0,template:'<img src="" alt="" />'}}),angular.module("Controllers",[]).controller("DemoController",["$scope",function(o){console.log("启动了")}]).controller("NavController",["$scope",function(o){o.navs=[{link:"#/today",text:"今日一刻",icon:"icon-home"},{link:"#/older",text:"往期内容",icon:"icon-file-empty"},{link:"#/author",text:"热门作者",icon:"icon-pencil"},{link:"#/category",text:"栏目浏览",icon:"icon-menu"},{link:"#/favorite",text:"我的喜欢",icon:"icon-heart"},{link:"#/settings",text:"设置",icon:"icon-cog"}]}]).controller("TodayController",["$scope","$http","$filter","$rootScope",function(o,e,t,l){var r=t("date")(new Date,"yyyy-MM-dd");l.title="今日一刻",l.index=0,l.loaded=!1,e({url:"./api/today.php",method:"get",params:{today:r}}).then(function(e){l.loaded=!0,o.date=e.data.date,o.posts=e.data.posts},function(o){console.log(o)})}]).controller("OlderController",["$scope","$http","$rootScope","$filter",function(o,e,t,l){function r(){return parseFloat(document.querySelector(".scroll").scrollHeight-d)}function n(){return parseFloat(document.querySelector(".scroll").scrollTop)}function c(){e({url:"./api/prev.php",params:{cut:a}}).then(function(e){o.prev=e.data.prev,o.prevs.push(o.prev),t.loaded=!0,a==-1&&(u.innerHTML=l("date")(o.prev.date,"ddMMM")),setTimeout(function(){a-=1,p=!1},0)},function(o){p=!1,console.log(o)})}t.title="往期内容",t.index=1,t.loaded=!1,t.loadedPrev=!0;var a=-1;o.prevs=[];var i,s=document.querySelectorAll(".prev"),d=parseFloat(document.querySelector(".navs").offsetHeight),u=document.querySelector(".fixed"),p=!1;c(),setInterval(function(){o.prevs.forEach(function(o,e){s=document.querySelectorAll(".prev");var t=s[e].offsetTop,r=s[e].offsetTop+s[e].offsetHeight;scrollDistance=n();var c=document.querySelector(".header").offsetHeight;a<-1&&scrollDistance+c>=t&&scrollDistance+c<r&&(u.innerHTML=l("date")(o.date,"ddMMM"))})},500),document.querySelector(".scroll").onscroll=function(){p||0==p&&(i=r(),scrollDistance=n(),scrollDistance>=i-10&&(p=!0,c()))}}]).controller("AuthorController",["$scope","$http","$rootScope",function(o,e,t){t.index=2,t.title="热门作者",t.loaded=!1,e({url:"./api/author.php"}).then(function(e){console.log(e),t.loaded=!0,o.rec=e.data.rec,o.all=e.data.all},function(o){console.log(o)})}]).controller("CenterController",["$scope","$http","$rootScope","$location",function(o,e,t,l){var r=l.search().id;t.title=l.search().name+"的主页",t.loaded=!1,e({url:"./api/center.php",params:{id:r}}).then(function(e){console.log(e),t.loaded=!0,o.author=e.data.author,o.posts=e.data.posts},function(o){console.log(o)})}]).controller("CategoryController",["$scope","$http","$rootScope",function(o,e,t){t.index=3,t.title="栏目浏览",t.loaded=!1,e({url:"./api/category.php"}).then(function(e){t.loaded=!0,o.columns=e.data.columns},function(o){console.log(o)})}]).controller("ListController",["$scope","$http","$rootScope","$location",function(o,e,t,l){var r=l.search().id;t.title="文章列表",t.loaded=!1,e({url:"./api/list.php",params:{id:r}}).then(function(e){t.loaded=!0,o.column=e.data.column,o.posts=e.data.posts},function(o){console.log(o)})}]).controller("FavoriteController",["$scope","$http","$rootScope","$filter","$window",function(o,e,t,l,r){t.loaded=!1,t.title="我的喜欢",t.index=4}]).controller("SettingsController",["$rootScope",function(o){o.loaded=!0,o.title="设置",o.index=5}]);